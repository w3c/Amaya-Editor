#
# Makefile for Amaya WWW Browser/Editor
# Generated from amaya/Makefile.in
# Daniel Veillard and Irene Vatton, 1997
#

@VPATHOPT@= @srcdir@
THOTDIR = @top_srcdir@
WWWDAV = @WWWDAV@
LIBWWW_RDF_PARSER = @LIBWWW_RDF_PARSER@
LIBZ = @LIBZ@

OBJDIRS = wxdialog

include ../Options

INCLUDES= -DHAVE_CONFIG_H $(AMAYA_INCLUDES) $(EXPAT_INCLUDES) $(GUI_INCLUDES) $(EXTRA_INCLUDES) $(GL_INCLUDES) $(GTK_GL_INCLUDES) $(FREETYPE_INCLUDES) $(XFT_INCLUDES)
LIBS	=  $(AMAYA_PLUGIN_LIBS) $(AMAYA_ANNOT_LIBS) $(AMAYA_DAV_LIBS) \
	   @AMAYA_RAPTOR_LIBS@ \
	   $(AMAYA_MATH_LIBS) $(AMAYA_GRAPH_LIBS) \
           -L../thotlib -L.. -lThotEditor \
          $(AMAYA_OPTION_EXTRA_LIBS) $(IMGLIBS) $(EXPAT_LIBRARIES) \
	  $(AMAYA_LIBWWW_LIBS) \
	  $(GTK_LIBRARIES) $(WX_LIBRARIES) \
	  @LIBS@ @EXTRA_LIBS@ $(GL_LIBRARIES) $(GTK_GL_LIBRARIES) $(FREETYPE_LIBRARIES) $(XFT_LIBRARIES)

CONFIGFILES=XKeysymDB unix-thot.rc amaya.keyboard amaya.profiles\
	    *-amayadialogue *-amayamsg *-libdialogue *-corrdialogue \
	    amaya.emacs annot.schemas *.rdf fonts.* gtkrc

LIBCONFIGFILES=*.css *.png *.lhtml *.svg 

ANNOTFILES=*.STR *.PRS *.TRA *.en *.gif *.png 

DICOFILES= *.ptn *.dic alphabet clavier

AMAYAFILES= *.STR *.conf *.trans* *.en *.gif *.png \
           *.PRS *.TRA AmayaPage.html AmayaPage.html.* Amaya.svg

RESOURCE_XRC_FILES= *.xrc
RESOURCE_ICONS_FILES= *.gif

FONTSFILES=Families.list fonts.dir icones*

AMAYA	= @top_srcdir@/amaya

prefix = @prefix@
exec_prefix = @exec_prefix@
libdir = @libdir@
bindir = @bindir@
comp_plugin: $(amaya_comp_plugin)
comp_annot: $(amaya_comp_annot)

#
# specific entry point check the dependancies
#

amaya : directories ../thotlib/libThotEditor.a amaya_schemas amaya_src ../bin/amaya

#
# General entry point everything should have compiled correctly
#
all : directories amaya_schemas amaya_src ../bin/amaya @NOPRINT@../bin/print

clean :
	$(RM) *.o *.h *.c EDITOR* HTML* TextFile* MathML* SVG* Timeline* XLink* XML* logo.* *.a
	(for dir in $(OBJDIRS) ; do $(RM) -r $$dir/*.o ; done)

directories : force
	@(for dir in $(OBJDIRS) ; \
	  do if test ! -d $$dir ; then $(MKDIR) $$dir ; fi ; done)

include .depends

force :

../bin/str :
	@(cd ../batch ; $(MAKE) CC="$(CC)" CFLAGS="$(CFLAGS)" CXX="$(CXX)" CXXFLAGS="$(CXXFLAGS)" app str prs tra)

../bin/tra :
	@(cd ../batch ; $(MAKE) CC="$(CC)" CFLAGS="$(CFLAGS)" CXX="$(CXX)" CXXFLAGS="$(CXXFLAGS)" app str prs tra)

../bin/prs :
	@(cd ../batch ; $(MAKE) CC="$(CC)" CFLAGS="$(CFLAGS)" CXX="$(CXX)" CXXFLAGS="$(CXXFLAGS)" app str prs tra)

../bin/app :
	@(cd ../batch ; $(MAKE) CC="$(CC)" CFLAGS="$(CFLAGS)" CXX="$(CXX)" CXXFLAGS="$(CXXFLAGS)" app str prs tra)

../bin/printstr: 
	@(cd ../batch ; $(MAKE) CC="$(CC)" CFLAGS="$(CFLAGS)" CXX="$(CXX)" CXXFLAGS="$(CXXFLAGS)" printstr)

../thotlib/libThotEditor.a : force
	@(cd ../thotlib ; $(MAKE) CC="$(CC)" CFLAGS="$(CFLAGS)" CXX="$(CXX)" CXXFLAGS="$(CXXFLAGS)" libThotEditor)

../libjpeg.a : @MAKEJPEG@ force
	@(cd ../libjpeg ; $(MAKE) CC="$(CC)" CFLAGS="-O -x c")

../libpng.a : @MAKEPNG@ force
	@(cd ../libpng ; $(MAKE) CC="$(CC)" CFLAGS="-O -x c")

../libz.a : @MAKEPNG@ force
	@(cd ../libpng/zlib ; $(MAKE) CC="$(CC)" CFLAGS="-O -x c")

../tools/mkdep/mkdep : 
	@(cd ../tools/mkdep ; $(MAKE) CC="$(CC)" CFLAGS="-O -x c")

../libraptor/.libs/libraptor.a \
amaya_comp_libraptor: @MAKERAPTOR@ force
	@(cd .. ; $(MAKE) libraptor CC="$(CC)" CFLAGS="-O2 -x c")

../redland/librdf/.libs/librdf.a \
../redland/raptor/.libs/libraptor.a \
amaya_comp_redland: @MAKEREDLAND@ force
	@(cd .. ; $(MAKE) redland CC="$(CC)" CFLAGS="-O2")

.depends depend : ../tools/mkdep/mkdep
	../tools/mkdep/mkdep -relative -vpath $(VPATH) $(INCLUDES) $(VPATH)/*.c > .depends

#########################################################################
#									#
#		Optional configuration rules				#
#									#
#########################################################################

#include the fragment "pluginlib/Makefile.plugin" for plugins if configured in
@plugin_frag@

#include the fragment "amaya/Makefile.libwww" for libwww if configured in
@www_frag@

#include the fragment "amaya/Makefile.svg" for svg if configured in
@svg_frag@

#include the fragment "amaya/Makefile.math" for math if configured in
@math_frag@

#include the fragment "annotlib//Makefile.annot" for annotations if configured in
@annot_frag@

#include the fragment "davlib/Makefile.dav" for webdav if configured in
@dav_frag@



#########################################################################
#									#
#		         General rules					#
#									#
#########################################################################

ALL_AMAYA_OPTIONS= $(AMAYA_OPTIONS) \
	 $(AMAYA_PLUGIN_OPTIONS) $(AMAYA_LIBWWW_OPTIONS) \
	 $(AMAYA_MATH_OPTIONS) $(AMAYA_SVG_OPTIONS) $(AMAYA_ANNOT_OPTIONS) \
	 $(AMAYA_DAV_OPTIONS) $(EXPAT_OPTIONS)

AMAYA_OPTION_INCLUDES= $(AMAYA_PLUGIN_INCLUDES) \
         $(AMAYA_LIBWWW_INCLUDES) $(AMAYA_MATH_INCLUDES) \
	 $(AMAYA_SVG_INCLUDES) $(AMAYA_ANNOT_INCLUDES) \
	 $(AMAYA_DAV_INCLUDES)

AMAYA_OPTION_OBJ= $(AMAYA_PLUGIN_OBJ) \
         $(AMAYA_LIBWWW_OBJ) $(AMAYA_SVG_OBJ) $(AMAYA_MATH_OBJ) \
         $(AMAYA_ANNOT_OBJ) $(AMAYA_DAV_OBJ)

AMAYA_SRC= $(AMAYA_PLUGIN_SRC) \
         $(AMAYA_LIBWWW_SRC) @AMAYA_RAPTOR_SRC@ \
	 $(AMAYA_MATH_SRC) $(AMAYA_SVG_SRC) \
         $(AMAYA_ANNOT_SRC) $(AMAYA_DAV_SRC)

AMAYA_OPTION_LIBS= $(AMAYA_PLUGIN_LIBS) \
         $(AMAYA_LIBWWW_OPTION_LIBS) $(AMAYA_MATH_LIBS) $(AMAYA_GRAPH_LIBS) \
         $(AMAYA_ANNOT_LIBS) $(AMAYA_DAV_LIBS) @AMAYA_RAPTOR_LIBS@

AMAYA_OPTION_EXTRA_LIBS= $(AMAYA_PLUGIN_EXTRA_LIBS) \
         $(AMAYA_LIBWWW_EXTRA_LIBS) $(AMAYA_MATH_EXTRA_LIBS) \
         $(AMAYA_GRAPH_EXTRA_LIBS) $(AMAYA_ANNOT_EXTRA_LIBS)

AMAYA_OPTION_SCHEMAS= $(AMAYA_PLUGIN_SCHEMAS) \
         $(AMAYA_LIBWWW_SCHEMAS) $(MATH_SCHEMAS) $(SVG_SCHEMAS) \
         $(ANNOT_SCHEMAS) 

AMAYA_INCLUDES= -I. -I.. -I@top_srcdir@/thotlib/include -I@srcdir@ \
		-I@srcdir@/f -I@srcdir@/xpm \
                -I@top_srcdir@/libpng/zlib $(AMAYA_OPTION_INCLUDES)

AMAYA_LIBS= ../thotlib/libThotEditor.a \
            libCSS.a $(AMAYA_OPTION_LIBS) \
             $(LIBZ)

HTML2THOT_LIBS= -L../thotlib/ -lThotKernel -L.. -lz

amaya_schemas : compHTML compHTMLP compHTMLT compTextFile  compTextFileP compTextFileT compXLink compXLinkP compXLinkT compXML compXMLP compXMLT compHTMLA compTextFileA compXLinkA compXMLA $(svg_schema) $(math_schema) $(annot_schema) compEDITORA 

amaya_src :  HTML.h $(AMAYA_SRC) $(MATH_SCHEMAS) $(SVG_SCHEMAS)

#
# Rule to build objects
#
.c.o :
	$(CXX) $(CXXFLAGS) $(ALL_AMAYA_OPTIONS) $(INCLUDES) -c $< -o $@
#
# Rule to build c++ objects
#
.cpp.o :
	$(CXX) $(CXXFLAGS) $(ALL_AMAYA_OPTIONS) $(INCLUDES) -c $< -o $@

#########################################################################
#									#
#		Rules to build the binary				#
#									#
#########################################################################

CSS_OBJ = \
	css.o \
	fetchHTMLname.o \
	fetchXMLname.o \
	styleparser.o

# Specific schema dependencies
fetchXMLname.o : $(MATH_SCHEMAS) $(SVG_SCHEMAS)

libCSS : libCSS.a

libCSS.a : $(CSS_OBJ) 
	$(AR) libCSS.a $(CSS_OBJ)
	$(RANLIB) libCSS.a

AMAYA_OBJ = \
	wxdialog/TitleDlgWX.o \
	wxdialog/InitConfirmDlgWX.o \
	wxdialog/OpenDocDlgWX.o \
	wxdialog/SearchDlgWX.o \
	wxdialog/PrintDlgWX.o \
	wxdialog/SaveAsDlgWX.o \
	wxdialog/CSSDlgWX.o \
	wxdialog/AmayaDialog.o \
	wxdialog/DocInfoDlgWX.o \
	wxdialog/HRefDlgWX.o \
	wxdialog/CreateTableDlgWX.o \
	wxdialog/PreferenceDlgWX.o \
	wxdialog/SpellCheckDlgWX.o \
	wxdialogapi.o \
	EDITORAPP.o \
	HTMLAPP.o \
	TextFileAPP.o \
	XLinkAPP.o \
	XMLAPP.o \
	AHTURLTools.o \
	EDITORactions.o \
	EDITimage.o \
	EDITstyle.o \
	HTMLactions.o \
	HTMLbook.o \
	HTMLedit.o \
	HTMLform.o \
	HTMLhistory.o \
	HTMLimage.o \
	HTMLpresentation.o \
	HTMLsave.o \
	HTMLtable.o \
	html2thot.o \
	init.o \
	libmanag.o \
	MENUconf.o \
	XLinkbuilder.o \
	XLinkedit.o \
	templates.o \
	trans.o \
	transparse.o \
	UIcss.o \
	Xml2thot.o \
	Xmlbuilder.o \
	XHTMLbuilder.o \
	XPointer.o \
	XPointerparse.o 

# Specific schema dependencies
HTMLtable.o : $(MATH_SCHEMAS)

#
# HTML structure schema compilation.
#
compHTML: $(AMAYA)/HTML.STR
$(AMAYA)/HTML.STR : $(AMAYA)/HTML.S ../bin/str
	STR=`pwd`/../bin/str;PRS=`pwd`/../bin/prs;TRA=`pwd`/../bin/tra;\
	cd $(AMAYA); THOTDIR=`pwd`/.. ;export THOTDIR; \
	$$STR $(ALL_AMAYA_OPTIONS) HTML ;\
	$$PRS $(ALL_AMAYA_OPTIONS) HTMLP ;\
	$$PRS $(ALL_AMAYA_OPTIONS) -DPAGE HTMLP HTMLPP ;\
	$$PRS $(ALL_AMAYA_OPTIONS) -DPAGE -DLANDSCAPE HTMLP HTMLPL ;\
	$$PRS $(ALL_AMAYA_OPTIONS) -DUS_PAPER HTMLP HTMLPPUS ;\
	$$PRS $(ALL_AMAYA_OPTIONS) -DUS_PAPER -DLANDSCAPE HTMLP HTMLUSL ;\
	$$PRS $(ALL_AMAYA_OPTIONS) -DLINK_NUMBER -DPAGE HTMLP HTMLPLP ;\
	$$PRS $(ALL_AMAYA_OPTIONS) -DLINK_NUMBER -DPAGE -DLANDSCAPE HTMLP  HTMLPLL ;\
	$$PRS $(ALL_AMAYA_OPTIONS) -DLINK_NUMBER -DUS_PAPER HTMLP HTMLPLPUS ;\
	$$PRS $(ALL_AMAYA_OPTIONS) -DLINK_NUMBER -DUS_PAPER -DLANDSCAPE HTMLP HTMLUSLL ;\
	$$PRS $(ALL_AMAYA_OPTIONS) -DBLACK_WHITE HTMLP HTMLPBW ;\
	$$TRA $(ALL_AMAYA_OPTIONS) HTMLT ;\
	$$TRA $(ALL_AMAYA_OPTIONS) -DXML HTMLT HTMLTX;\
	$$TRA $(ALL_AMAYA_OPTIONS) -DXML -DXHTML11 HTMLT HTMLT11;\
	$$TRA $(ALL_AMAYA_OPTIONS) HTMLTT

#
# HTML presentation schemas compilation
#
compHTMLP: $(AMAYA)/HTMLP.PRS
$(AMAYA)/HTMLP.PRS : $(AMAYA)/HTMLP.P ../bin/prs
	PRS=`pwd`/../bin/prs ; \
	cd $(AMAYA); THOTDIR=`pwd`/.. ;export THOTDIR; \
	$$PRS $(ALL_AMAYA_OPTIONS) HTMLP ;\
	$$PRS $(ALL_AMAYA_OPTIONS) -DPAGE HTMLP HTMLPP ;\
	$$PRS $(ALL_AMAYA_OPTIONS) -DPAGE -DLANDSCAPE HTMLP HTMLPL ;\
	$$PRS $(ALL_AMAYA_OPTIONS) -DUS_PAPER HTMLP HTMLPPUS ;\
	$$PRS $(ALL_AMAYA_OPTIONS) -DUS_PAPER -DLANDSCAPE HTMLP HTMLUSL ;\
	$$PRS $(ALL_AMAYA_OPTIONS) -DLINK_NUMBER -DPAGE HTMLP HTMLPLP ;\
	$$PRS $(ALL_AMAYA_OPTIONS) -DLINK_NUMBER -DPAGE -DLANDSCAPE HTMLP  HTMLPLL ;\
	$$PRS $(ALL_AMAYA_OPTIONS) -DLINK_NUMBER -DUS_PAPER HTMLP HTMLPLPUS ;\
	$$PRS $(ALL_AMAYA_OPTIONS) -DLINK_NUMBER -DUS_PAPER -DLANDSCAPE HTMLP HTMLUSLL ;\
	$$PRS $(ALL_AMAYA_OPTIONS) -DBLACK_WHITE HTMLP HTMLPBW 
#
# HTML translation schemas compilation
#
compHTMLT: $(AMAYA)/HTMLT.TRA
$(AMAYA)/HTMLT.TRA : $(AMAYA)/HTMLT.T $(AMAYA)/HTMLTT.T ../bin/tra
	TRA=`pwd`/../bin/tra ; \
	cd $(AMAYA); THOTDIR=`pwd`/.. ;export THOTDIR ;\
	$$TRA $(ALL_AMAYA_OPTIONS) HTMLT ;\
	$$TRA $(ALL_AMAYA_OPTIONS) -DXML HTMLT HTMLTX;\
	$$TRA $(ALL_AMAYA_OPTIONS) -DXML -DXHTML11 HTMLT HTMLT11;\
	$$TRA $(ALL_AMAYA_OPTIONS) HTMLTT

#
# TextFile schemas compilation
#
compTextFile: $(AMAYA)/TextFile.STR
$(AMAYA)/TextFile.STR : $(AMAYA)/TextFile.S ../bin/str
	STR=`pwd`/../bin/str;PRS=`pwd`/../bin/prs;TRA=`pwd`/../bin/tra;\
	cd $(AMAYA); THOTDIR=`pwd`/.. ;export THOTDIR; \
	$$STR $(ALL_AMAYA_OPTIONS) TextFile ;\
	$$PRS $(ALL_AMAYA_OPTIONS) TextFileP ;\
	$$PRS $(ALL_AMAYA_OPTIONS) -DPAGE TextFileP TextFilePP ;\
	$$PRS $(ALL_AMAYA_OPTIONS) -DPAGE -DLANDSCAPE TextFileP TextFilePL ;\
	$$PRS $(ALL_AMAYA_OPTIONS) -DUS_PAPER TextFileP TextFilePPUS ;\
	$$PRS $(ALL_AMAYA_OPTIONS) -DUS_PAPER -DLANDSCAPE TextFileP TextFileUSL ;\
	$$TRA $(ALL_AMAYA_OPTIONS) TextFileT

#
# TextFile presentation schemas compilation
#
compTextFileP: $(AMAYA)/TextFileP.PRS
$(AMAYA)/TextFileP.PRS : $(AMAYA)/TextFileP.P ../bin/prs
	PRS=`pwd`/../bin/prs ; \
	cd $(AMAYA); THOTDIR=`pwd`/.. ;export THOTDIR; \
	$$STR $(ALL_AMAYA_OPTIONS) TextFile ;\
	$$PRS $(ALL_AMAYA_OPTIONS) TextFileP ;\
	$$PRS $(ALL_AMAYA_OPTIONS) -DPAGE TextFileP TextFilePP ;\
	$$PRS $(ALL_AMAYA_OPTIONS) -DPAGE -DLANDSCAPE TextFileP TextFilePL ;\
	$$PRS $(ALL_AMAYA_OPTIONS) -DUS_PAPER TextFileP TextFilePPUS ;\
	$$PRS $(ALL_AMAYA_OPTIONS) -DUS_PAPER -DLANDSCAPE TextFileP TextFileUSL

#
# TextFile translation schemas compilation
#
compTextFileT: $(AMAYA)/TextFileT.TRA
$(AMAYA)/TextFileT.TRA : $(AMAYA)/TextFileT.T ../bin/tra
	TRA=`pwd`/../bin/tra ; \
	cd $(AMAYA); THOTDIR=`pwd`/.. ;export THOTDIR ;\
	$$TRA $(ALL_AMAYA_OPTIONS) TextFileT

#
# XLink structure schema compilation
#
compXLink: $(AMAYA)/XLink.STR
$(AMAYA)/XLink.STR : $(AMAYA)/XLink.S ../bin/str
	STR=`pwd`/../bin/str;PRS=`pwd`/../bin/prs;TRA=`pwd`/../bin/tra;\
	cd $(AMAYA); THOTDIR=`pwd`/.. ;export THOTDIR; \
	$$STR $(ALL_AMAYA_OPTIONS) XLink ;\
	$$PRS $(ALL_AMAYA_OPTIONS) XLinkP ;\
	$$TRA $(ALL_AMAYA_OPTIONS) XLinkT

#
# XLink presentation schema compilation
#
compXLinkP: $(AMAYA)/XLinkP.PRS
$(AMAYA)/XLinkP.PRS : $(AMAYA)/XLinkP.P ../bin/prs
	PRS=`pwd`/../bin/prs ; \
	cd $(AMAYA); THOTDIR=`pwd`/.. ;export THOTDIR; \
	$$PRS $(ALL_AMAYA_OPTIONS) XLinkP

#
# XLink translation schema compilation
#
compXLinkT: $(AMAYA)/XLinkT.TRA
$(AMAYA)/XLinkT.TRA : $(AMAYA)/XLinkT.T ../bin/tra
	TRA=`pwd`/../bin/tra ; \
	cd $(AMAYA); THOTDIR=`pwd`/.. ;export THOTDIR ;\
	$$TRA $(ALL_AMAYA_OPTIONS) XLinkT

#
# Generic XML structure schema compilation.
#
compXML: $(AMAYA)/XML.STR
$(AMAYA)/XML.STR : $(AMAYA)/XML.S ../bin/str
	STR=`pwd`/../bin/str;PRS=`pwd`/../bin/prs;TRA=`pwd`/../bin/tra;\
	cd $(AMAYA); THOTDIR=`pwd`/.. ;export THOTDIR; \
	$$STR $(ALL_AMAYA_OPTIONS) XML ;\
	$$PRS $(ALL_AMAYA_OPTIONS) XMLP ;\
	$$PRS $(ALL_AMAYA_OPTIONS) -DPAGE XMLP XMLPP ;\
	$$PRS $(ALL_AMAYA_OPTIONS) -DPAGE -DLANDSCAPE XMLP XMLPL ;\
	$$PRS $(ALL_AMAYA_OPTIONS) -DUS_PAPER XMLP XMLPPUS ;\
	$$PRS $(ALL_AMAYA_OPTIONS) -DUS_PAPER -DLANDSCAPE XMLP XMLUSL ;\
	$$TRA $(ALL_AMAYA_OPTIONS) XMLT

#
# Generic XML presentation schemas compilation
#
compXMLP: $(AMAYA)/XMLP.PRS
$(AMAYA)/XMLP.PRS : $(AMAYA)/XMLP.P ../bin/prs
	PRS=`pwd`/../bin/prs ; \
	cd $(AMAYA); THOTDIR=`pwd`/.. ;export THOTDIR; \
	$$STR $(ALL_AMAYA_OPTIONS) XML ;\
	$$PRS $(ALL_AMAYA_OPTIONS) XMLP ;\
	$$PRS $(ALL_AMAYA_OPTIONS) -DPAGE XMLP XMLPP ;\
	$$PRS $(ALL_AMAYA_OPTIONS) -DPAGE -DLANDSCAPE XMLP XMLPL ;\
	$$PRS $(ALL_AMAYA_OPTIONS) -DUS_PAPER XMLP XMLPPUS ;\
	$$PRS $(ALL_AMAYA_OPTIONS) -DUS_PAPER -DLANDSCAPE XMLP XMLUSL

#
# Generic XML translation schemas compilation
#
compXMLT: $(AMAYA)/XMLT.TRA
$(AMAYA)/XMLT.TRA : $(AMAYA)/XMLT.T ../bin/tra
	TRA=`pwd`/../bin/tra ; \
	cd $(AMAYA); THOTDIR=`pwd`/.. ;export THOTDIR ;\
	$$TRA $(ALL_AMAYA_OPTIONS) XMLT

#
# Interface schemas compilation
#
HTMLAPP.o : HTMLAPP.c
	$(CXX) $(CXXFLAGS) $(ALL_AMAYA_OPTIONS) $(INCLUDES) -c HTMLAPP.c -o $@

compHTMLA : HTML.h HTMLAPP.c

HTML.h HTMLAPP.c : @srcdir@/HTML.STR @srcdir@/HTML.A
	(if test "@srcdir@" != "" -a "@srcdir@" != "." ; then \
	    $(CP) @srcdir@/HTML.A .  ; \
	    $(CP) @srcdir@/HTML.STR .  ; \
	fi)
	THOTDIR=$(THOTDIR) ; export THOTDIR ; \
	../bin/app $(ALL_AMAYA_OPTIONS) HTML.A

TextFileAPP.o : TextFileAPP.c
	$(CXX) $(CXXFLAGS) $(ALL_AMAYA_OPTIONS) $(INCLUDES) -c TextFileAPP.c -o $@

compTextFileA : TextFile.h TextFileAPP.c

TextFile.h TextFileAPP.c : @srcdir@/TextFile.STR @srcdir@/TextFile.A
	(if test "@srcdir@" != "" -a "@srcdir@" != "." ; then \
	    $(CP) @srcdir@/TextFile.A .  ; \
	    $(CP) @srcdir@/TextFile.STR .  ; \
	fi)
	THOTDIR=$(THOTDIR) ; export THOTDIR ; \
	../bin/app $(ALL_AMAYA_OPTIONS) TextFile.A

XLinkAPP.o : XLinkAPP.c
	$(CXX) $(CXXFLAGS) $(ALL_AMAYA_OPTIONS) $(INCLUDES) -c XLinkAPP.c -o $@

compXLinkA : XLink.h XLinkAPP.c

XLink.h XLinkAPP.c : @srcdir@/XLink.STR @srcdir@/XLink.A
	(if test "@srcdir@" != "" -a "@srcdir@" != "." ; then \
	    $(CP) @srcdir@/XLink.A .  ; \
	    $(CP) @srcdir@/XLink.STR .  ; \
	fi)
	THOTDIR=$(THOTDIR) ; export THOTDIR ; \
	../bin/app $(ALL_AMAYA_OPTIONS) XLink.A

XMLAPP.o : XMLAPP.c
	$(CXX) $(CXXFLAGS) $(ALL_AMAYA_OPTIONS) $(INCLUDES) -c XMLAPP.c -o $@

compXMLA : XML.h XMLAPP.c

XML.h XMLAPP.c : @srcdir@/XML.STR @srcdir@/XML.A
	(if test "@srcdir@" != "" -a "@srcdir@" != "." ; then \
	    $(CP) @srcdir@/XML.A .  ; \
	    $(CP) @srcdir@/XML.STR .  ; \
	fi)
	THOTDIR=$(THOTDIR) ; export THOTDIR ; \
	../bin/app $(ALL_AMAYA_OPTIONS) XML.A

EDITORAPP.o : EDITORAPP.c
	$(CXX) $(CXXFLAGS) $(ALL_AMAYA_OPTIONS) $(INCLUDES) -c EDITORAPP.c -o $@

compEDITORA : EDITORAPP.c

EDITORAPP.c : @srcdir@/EDITOR.A
	(if test "@srcdir@" != "" -a "@srcdir@" != "." -a \
	         "@srcdir@" != "../amaya" ; then \
	    $(CP) @srcdir@/EDITOR.A . ; \
	    $(CP) @srcdir@/xpm/logo.xpm . ; \
	fi)
	THOTDIR=$(THOTDIR) ; export THOTDIR ; \
	../bin/app $(ALL_AMAYA_OPTIONS) EDITOR.A

# amaya application
../bin/amaya : $(AMAYA_OBJ) $(AMAYA_OPTION_OBJ) $(AMAYA_LIBS)
	@(if test ! -d ../bin ; then $(MKDIR) ../bin ; fi)
	$(LD) $(LDFLAGS) -o ../bin/amaya $(AMAYA_OBJ) $(AMAYA_OPTION_OBJ) libCSS.a $(LIBS)
	@$(ECHO) "====>" amaya is done

@NOPRINT@../bin/print :
@NOPRINT@	@(cd ../thotlib ; $(MAKE) CC="$(CC)" CFLAGS="$(CFLAGS)" CXX="$(CXX)" CXXFLAGS="$(CXXFLAGS)" print)

install : all @NOPRINT@../bin/print
	@(if test ! -d $(prefix) ; then $(MKDIR) $(prefix) ; fi)
	@(if test ! -d $(prefix)/Amaya ; then $(MKDIR) $(prefix)/Amaya ; fi)
	@(if test ! -d $(prefix)/Amaya/amaya ; then $(MKDIR) $(prefix)/Amaya/amaya ; fi)
	@(if test ! -d $(prefix)/Amaya/resources ; then $(MKDIR) $(prefix)/Amaya/resources ; fi)
	@(if test ! -d $(prefix)/Amaya/resources/xrc ; then $(MKDIR) $(prefix)/Amaya/resources/xrc ; fi)
	@(if test ! -d $(prefix)/Amaya/resources/icons ; then $(MKDIR) $(prefix)/Amaya/resources/icons ; fi)
	@(if test ! -d $(prefix)/Amaya/config ; then $(MKDIR) $(prefix)/Amaya/config ; fi)
	@(if test ! -d $(prefix)/Amaya/annotlib ; then $(MKDIR) $(prefix)/Amaya/annotlib ; fi)
	@(if test ! -d $(prefix)/Amaya/fonts ; then $(MKDIR) $(prefix)/Amaya/fonts ; fi)
	@(if test ! -d $(prefix)/Amaya/dicopar ; then $(MKDIR) $(prefix)/Amaya/dicopar ; fi)
	@(if test ! -d $(prefix)/Amaya/doc ; then $(MKDIR) $(prefix)/Amaya/doc ; fi)
	@(if test ! -d $(prefix)/Amaya/applis ; then $(MKDIR) $(prefix)/Amaya/applis ; fi)
	@(if test ! -d $(prefix)/Amaya/applis/bin ; then $(MKDIR) $(prefix)/Amaya/applis/bin ; fi)
	@(if test ! -d $(prefix)/Amaya/davlib ; then $(MKDIR) $(prefix)/Amaya/davlib ; fi)
	@(if test ! -d $(prefix)/Amaya/config/libconfig ; then $(MKDIR) $(prefix)/Amaya/config/libconfig ; fi)
	@(if test ! -d $(bindir) ; then $(MKDIR) $(bindir) ; fi)
	$(INSTALL_BIN) ../bin/amaya $(prefix)/Amaya/applis/bin
@NOPRINT@	$(INSTALL_BIN) ../bin/print $(prefix)/Amaya/applis/bin
	$(RM) $(bindir)/amaya
	$(LN_S) $(prefix)/Amaya/applis/bin/amaya $(bindir)/amaya
	(for i in $(AMAYAFILES) ; do \
	  for file in `$(ECHO) $(THOTDIR)/amaya/$$i` ; do \
	    $(INSTALL_DATA) $$file $(prefix)/Amaya/amaya ; \
	  done ; done)
	(for i in $(RESOURCE_XRC_FILES) ; do \
	  for file in `$(ECHO) $(THOTDIR)/resources/xrc/$$i` ; do \
	    $(INSTALL_DATA) $$file $(prefix)/Amaya/resources/xrc ; \
	  done ; done)
	(for i in $(RESOURCE_ICONS_FILES) ; do \
	  for file in `$(ECHO) $(THOTDIR)/resources/icons/$$i` ; do \
	    $(INSTALL_DATA) $$file $(prefix)/Amaya/resources/icons ; \
	  done ; done)
	(for i in $(CONFIGFILES) ; do \
	  for file in `$(ECHO) $(THOTDIR)/config/$$i` ; do \
	    $(INSTALL_DATA) $$file $(prefix)/Amaya/config 2>/dev/null || true ; \
	  done ; done)
	(for i in $(LIBCONFIGFILES) ; do \
	  for file in `$(ECHO) $(THOTDIR)/config/libconfig/$$i` ; do \
	    $(INSTALL_DATA) $$file $(prefix)/Amaya/config/libconfig 2>/dev/null || true ; \
	  done ; done)
	(cd $(THOTDIR)/annotlib ; \
          for i in $(ANNOTFILES) ; do \
	  for file in `$(ECHO) $$i` ; do \
	    $(INSTALL_DATA) $$file $(prefix)/Amaya/annotlib 2>/dev/null || true ; \
	  done ; done)
	(for i in $(DICOFILES) ; do \
	  for file in `$(ECHO) $(THOTDIR)/dicopar/$$i` ; do \
	    $(INSTALL_DATA) $$file $(prefix)/Amaya/dicopar ; \
	  done ; done)
	$(CP) -r $(THOTDIR)/doc/images $(prefix)/Amaya/doc
	$(CP) -r $(THOTDIR)/doc/html $(prefix)/Amaya/doc
	(for i in $(FONTSFILES) ; do \
	  for file in `$(ECHO) $(THOTDIR)/fonts/$$i` ; do \
	    $(INSTALL_DATA) $$file $(prefix)/Amaya/fonts ; \
	  done ; done)

uninstall : $(AMAYA_PLUGIN_UNINSTALL) \
		$(AMAYA_ANNOT_UNINSTALL) \
	$(RM) -rf $(prefix)/thot
	$(RM) -rf $(prefix)/Amaya
	$(RM) $(bindir)/amaya

CEXTRACT= ../bin/cextract

$(CEXTRACT) :
	@(cd ../tools/cextract-$(CEXTRACT_VER) ; $(MAKE))

proto : ../bin/cextract
	@(for i in @srcdir@/*.c ; \
	  do \
	  dir=`dirname $$i`;base=`basename $$i .c`; \
	  if [ ! -d $$dir/f ] ; then $(MKDIR) $$dir/f ;fi;\
	  $(CEXTRACT) $(CEXTRACT_FLAGS) -o /tmp/cextract.$$base.$$$$ $$i 2> /dev/null ; \
	  if [ -f $$dir/f/"$$base"_f.h ] ; \
	  then \
	      delta=`$(DIFF) /tmp/cextract.$$base.$$$$ $$dir/f/"$$base"_f.h` ; \
	      if [ "$$delta" != "" ] ; \
	      then \
	          echo "  $$i proto changed" ; \
		  $(MV) /tmp/cextract.$$base.$$$$ $$dir/f/"$$base"_f.h ; \
              else \
	          $(RM) /tmp/cextract.$$base.$$$$ ; \
	      fi ; \
	  else \
	      echo "  $$i proto added" ; \
	      $(MV) /tmp/cextract.$$base.$$$$ $$dir/f/"$$base"_f.h ; \
	  fi ; \
	 done)


